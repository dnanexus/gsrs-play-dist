"use strict";(self.webpackChunkgsrs_client=self.webpackChunkgsrs_client||[]).push([[7549],{7549:function(At,T,l){l.r(T),l.d(T,{SubstanceRelationshipsModule:function(){return St}});var v=l(48047),Z=l(78069),g=l(36362),M=l(80206),J=l(98568),x=l(20265),N=l(24582),q=l(52149),y=l(92507),Y=l(54025),L=l(24874),I=l(50253),t=l(76442),p=l(95758),Q=l(54244),A=l(44770),R=l(43365),m=l(90587),E=l(88951),P=l(59295),H=l(12570),B=l(35096),h=l(98002),V=l(83448),_=l(40089),b=l(65590);function j(n,s){if(1&n){var a=t.EpF();t.TgZ(0,"div"),t.TgZ(1,"button",1),t.NdJ("click",function(){return t.CHM(a),t.oxw().export("relationships")}),t._UZ(2,"mat-icon",2),t.qZA(),t.qZA()}}var $=function(){var n=function(){function s(a,i,e,o,c,u,r){(0,Z.Z)(this,s),this.configService=a,this.authService=i,this.substanceService=e,this.router=o,this.activatedRoute=c,this.loadingService=u,this.dialog=r,this.subscriptions=[],this.isAdmin=!1,this.privateExport=!1,this.etag="",this.paramUrl="",this.totalSubstance=0,this.hasAdditionalDownloads=!1,this.additionalExportOptions=[]}return(0,v.Z)(s,[{key:"ngOnInit",value:function(){var i=this;this.authService.hasAnyRolesAsync("Admin","Updater","SuperUpdater").pipe((0,P.q)(1)).subscribe(function(e){i.isAdmin=e}),this.loadedComponents=this.configService.configData&&this.configService.configData.loadedComponents||null}},{key:"ngAfterViewInit",value:function(){}},{key:"ngOnDestroy",value:function(){this.subscriptions.forEach(function(i){i&&i.unsubscribe()})}},{key:"export",value:function(i){var e=this,o=this.substanceService.searchFromString('q=root_uuid:"^'+this.substance.uuid+'$"').subscribe(function(c){if(c&&(e.etag=c.etag,e.totalSubstance=c.total),e.etag){var u="relationships.txt",r=e.getApiExportUrl(e.etag,u,i);if(!0===e.isAdmin){var f="";null!=i&&"relationships"===i&&(f="export"),e.dialog.open(B.L,{width:"700px",data:{extension:u,type:f,entity:"substances",hideOptionButtons:!0}}).afterClosed().subscribe(function(w){var S=w.name,xt=w.id;S&&""!==S&&(e.loadingService.setLoading(!0),e.authService.startUserDownload(r,e.privateExport,S+"."+u,xt).subscribe(function(O){e.loadingService.setLoading(!1),e.router.navigate(["/user-downloads/",O.id])},function(O){return e.loadingService.setLoading(!1)}))})}}});this.subscriptions.push(o)}},{key:"getApiExportUrl",value:function(i,e,o){return"".concat(this.configService.configData.apiBaseUrl,"api/v1/substances/export/").concat(i,"/").concat(e)}}]),s}();return n.\u0275fac=function(a){return new(a||n)(t.Y36(y.E),t.Y36(E.e),t.Y36(H.d),t.Y36(h.F0),t.Y36(h.gz),t.Y36(V.b),t.Y36(p.uw))},n.\u0275cmp=t.Xpm({type:n,selectors:[["app-relationships-download-button"]],inputs:{substance:"substance"},decls:2,vars:1,consts:[[4,"ngIf"],["mat-icon-button","","matTooltip","Export all relationships from this substancce",2,"padding-top","3px","background-color","white","border","none",3,"click"],["svgIcon","get_app"]],template:function(a,i){1&a&&(t.TgZ(0,"div"),t.YNc(1,j,3,0,"div",0),t.qZA()),2&a&&(t.xp6(1),t.Q6J("ngIf",i.isAdmin))},directives:[g.O5,_.gM,b.Hw],styles:[""]}),n}(),d=l(97217),C=l(64316),F=l(9292),k=l(73430),U=l(26439);function X(n,s){1&n&&(t.TgZ(0,"th",18),t._uU(1," Related Record"),t.qZA())}var D=function(s){return["/substances",s]};function K(n,s){if(1&n&&(t.TgZ(0,"td",19),t.TgZ(1,"div",20),t.TgZ(2,"div"),t._uU(3),t.qZA(),t._UZ(4,"img",21),t.TgZ(5,"div"),t.TgZ(6,"a",22),t._UZ(7,"span",23),t._UZ(8,"mat-icon",24),t.qZA(),t.qZA(),t.qZA(),t.qZA()),2&n){var a=s.$implicit;t.xp6(3),t.Oqu(a.relatedSubstance.linkingID),t.xp6(1),t.Q6J("entityId",a.relatedSubstance.refuuid),t.xp6(2),t.Q6J("routerLink",t.VKq(4,D,a.relatedSubstance.refuuid)),t.xp6(1),t.Q6J("innerHTML",a.relatedSubstance.name,t.oJD)}}function W(n,s){1&n&&(t.TgZ(0,"th",18),t._uU(1," Type "),t.qZA())}function G(n,s){if(1&n&&(t.TgZ(0,"td",25),t._uU(1),t.qZA()),2&n){var a=s.$implicit;t.xp6(1),t.hij(" ",a.type," ")}}function tt(n,s){1&n&&(t.TgZ(0,"th",26),t._uU(1," Details "),t.qZA())}function et(n,s){if(1&n&&(t.TgZ(0,"div",20),t.TgZ(1,"div"),t._uU(2),t.qZA(),t._UZ(3,"img",21),t.TgZ(4,"div"),t.TgZ(5,"a",22),t._UZ(6,"span",23),t._UZ(7,"mat-icon",24),t.qZA(),t.qZA(),t.qZA()),2&n){var a=t.oxw(2).$implicit;t.xp6(2),t.Oqu(a.mediatorSubstance.linkingID),t.xp6(1),t.Q6J("entityId",a.mediatorSubstance.refuuid),t.xp6(2),t.Q6J("routerLink",t.VKq(4,D,a.mediatorSubstance.refuuid)),t.xp6(1),t.Q6J("innerHTML",a.mediatorSubstance.name,t.oJD)}}function nt(n,s){1&n&&(t.TgZ(0,"div"),t.TgZ(1,"i"),t._uU(2,"none"),t.qZA(),t.qZA())}function it(n,s){if(1&n&&(t.TgZ(0,"div",39),t.TgZ(1,"div",40),t._uU(2," Interaction Type: "),t.qZA(),t.TgZ(3,"div",41),t._uU(4),t.qZA(),t.qZA()),2&n){var a=t.oxw(2).$implicit;t.xp6(4),t.hij(" ",a.interactionType," ")}}function at(n,s){if(1&n&&(t.TgZ(0,"div",39),t.TgZ(1,"div",40),t._uU(2," Comments: "),t.qZA(),t.TgZ(3,"div",41),t._uU(4),t.qZA(),t.qZA()),2&n){var a=t.oxw(2).$implicit;t.xp6(4),t.hij(" ",a.comments," ")}}function ot(n,s){if(1&n&&(t.TgZ(0,"div",39),t.TgZ(1,"div",40),t._uU(2," Qualification: "),t.qZA(),t.TgZ(3,"div",41),t._uU(4),t.qZA(),t.qZA()),2&n){var a=t.oxw(2).$implicit;t.xp6(4),t.hij(" ",a.qualification," ")}}function st(n,s){if(1&n&&(t.TgZ(0,"i"),t._uU(1),t.qZA()),2&n){var a=t.oxw(3).$implicit;t.xp6(1),t.Oqu(a.amount.nonNumericValue)}}function lt(n,s){if(1&n&&(t.TgZ(0,"div",39),t.TgZ(1,"div",40),t._uU(2," Amount: "),t.qZA(),t.TgZ(3,"div",41),t._uU(4),t.YNc(5,st,2,1,"i",35),t.qZA(),t.qZA()),2&n){var a=t.oxw(2).$implicit,i=t.oxw();t.xp6(4),t.hij(" ",i.displayAmount(a.amount)," "),t.xp6(1),t.Q6J("ngIf",a.amount.nonNumericValue)}}function ct(n,s){if(1&n){var a=t.EpF();t.TgZ(0,"h2",29),t._uU(1,"Details"),t.qZA(),t.TgZ(2,"div",30),t.TgZ(3,"table",31),t.TgZ(4,"tr"),t.TgZ(5,"th",32),t._uU(6," Mediator Substance "),t.qZA(),t.TgZ(7,"th",32),t._uU(8," Details "),t.qZA(),t.qZA(),t.TgZ(9,"tr"),t.TgZ(10,"td",33),t.YNc(11,et,8,6,"div",34),t.YNc(12,nt,3,0,"div",35),t.qZA(),t.TgZ(13,"td",33),t.YNc(14,it,5,1,"div",36),t.YNc(15,at,5,1,"div",36),t.YNc(16,ot,5,1,"div",36),t.YNc(17,lt,6,2,"div",36),t.qZA(),t.qZA(),t.qZA(),t.qZA(),t.TgZ(18,"div",37),t._UZ(19,"span",1),t.TgZ(20,"button",38),t.NdJ("click",function(){return t.CHM(a),t.oxw(2).close()}),t._uU(21,"Close"),t.qZA(),t.qZA()}if(2&n){var i=t.oxw().$implicit;t.xp6(11),t.Q6J("ngIf",i.mediatorSubstance),t.xp6(1),t.Q6J("ngIf",!i.mediatorSubstance),t.xp6(2),t.Q6J("ngIf",i.interactionType),t.xp6(1),t.Q6J("ngIf",i.comments),t.xp6(1),t.Q6J("ngIf",i.qualification),t.xp6(1),t.Q6J("ngIf",i.amount)}}function rt(n,s){if(1&n){var a=t.EpF();t.TgZ(0,"td",25),t.TgZ(1,"button",27),t.NdJ("click",function(){t.CHM(a);var o=t.MAs(4);return t.oxw().openModal(o)}),t._uU(2," View"),t.qZA(),t.YNc(3,ct,22,6,"ng-template",null,28,t.W1O),t.qZA()}if(2&n){var i=s.$implicit;t.xp6(1),t.Q6J("disabled",!(i.mediatorSubstance&&i.mediatorSubstance.name||i.qualification||i.interactionType||i.comments||i.amount&&i.amount.nonNumericValue))("ngClass",i.mediatorSubstance&&i.mediatorSubstance.name||i.qualification||i.interactionType||i.comments||i.amount&&i.amount.nonNumericValue?"":"mat-button-disabled")}}function ut(n,s){1&n&&(t.TgZ(0,"th",26),t._uU(1," References "),t.qZA())}function dt(n,s){if(1&n){var a=t.EpF();t.TgZ(0,"h2",29),t._uU(1,"References"),t.qZA(),t.TgZ(2,"div",30),t._UZ(3,"app-references-manager",44),t.qZA(),t.TgZ(4,"div",37),t._UZ(5,"span",1),t.TgZ(6,"button",38),t.NdJ("click",function(){return t.CHM(a),t.oxw(2).close()}),t._uU(7,"Close"),t.qZA(),t.qZA()}if(2&n){var i=t.oxw().$implicit,e=t.oxw();t.xp6(3),t.Q6J("substance",e.substance)("references",i.references)}}function pt(n,s){if(1&n){var a=t.EpF();t.TgZ(0,"td",25),t.TgZ(1,"button",42),t.NdJ("click",function(){t.CHM(a);var o=t.MAs(4);return t.oxw().openModal(o)}),t._uU(2),t.qZA(),t.YNc(3,dt,8,2,"ng-template",null,43,t.W1O),t.qZA()}if(2&n){var i=s.$implicit;t.xp6(1),t.Q6J("disabled",i.references.length<=0),t.xp6(1),t.hij("View ",i.references.length>0?i.references.length:""," references")}}function ft(n,s){1&n&&t._UZ(0,"tr",45)}function mt(n,s){1&n&&t._UZ(0,"tr",46)}var gt=function(){return[5,10,25,100]},ht=function(){var n=function(s){function a(i,e,o,c,u){var r;return(0,Z.Z)(this,a),r=function z(n,s,a){return s=(0,x.Z)(s),(0,M.Z)(n,(0,J.Z)()?Reflect.construct(s,a||[],(0,x.Z)(n).constructor):s.apply(n,a))}(this,a,[c]),r.utilService=i,r.configService=e,r.dialog=o,r.gaService=c,r.overlayContainerService=u,r.relationships=[],r.displayedColumns=["relatedRecord","type","details","references"],r.substanceUpdated=new I.x,r}return(0,N.Z)(a,s),(0,v.Z)(a,[{key:"ngOnInit",value:function(){var e=this;this.substanceUpdated.subscribe(function(o){if(e.relationships=[],e.substance=o,"RELATIONSHIPS"===e.type&&e.configService.configData&&e.configService.configData.substanceDetailsCards&&e.configService.configData.substanceDetailsCards.length){var c=e.configService.configData.substanceDetailsCards.find(function(r){return r.type===e.type});if(null!=c&&c.filters&&c.filters.length){var u=c.filters.find(function(r){return"substanceRelationships"===r.filterName})||{value:[]};e.excludedRelationships=u.value}}null!=e.substance&&null!=e.type&&(e.filterRelationhships(),e.countUpdate.emit(e.relationships.length),e.filtered=e.relationships,e.pageChange(),e.searchControl.valueChanges.subscribe(function(r){e.filterList(r,e.relationships,e.analyticsEventCategory)},function(r){console.log(r)}))}),this.overlayContainer=this.overlayContainerService.getContainerElement()}},{key:"sortData",value:function(e){var o=this,c=this.relationships.slice();if(!e.active||""===e.direction)return this.filtered=c,void this.pageChange();this.filtered=c.sort(function(u,r){var f="asc"===e.direction;switch(e.active){case"relatedRecord":return o.utilService.compare(u.relatedSubstance.name?u.relatedSubstance.name.toUpperCase():"",r.relatedSubstance.name?r.relatedSubstance.name.toUpperCase():"",f);case"type":return o.utilService.compare(u.type?u.type:"",r.type?r.type:"",f);default:return 0}}),this.pageChange(),this.overlayContainer=this.overlayContainerService.getContainerElement()}},{key:"filterRelationhships",value:function(){var e=this;this.substance.relationships&&this.substance.relationships.length>0&&this.substance.relationships.forEach(function(o){var c=o.type,u=c&&c.trim()||"";if(null!=e.excludedRelationships&&e.excludedRelationships instanceof Array){var r=!1;e.excludedRelationships.forEach(function(f){u.toLowerCase().indexOf(f.toLowerCase())>-1&&(r=!0)}),r||e.relationships.push(o)}else u.toLowerCase().indexOf(e.type.toLowerCase())>-1&&e.relationships.push(o)})}},{key:"hasDetails",value:function(e){return!!(e.mediatorSubstance&&e.mediatorSubstance.name||e.amount||e.qualification||e.interactionType||e.comments)}},{key:"openModal",value:function(e){var o=this;this.gaService.sendEvent(this.analyticsEventCategory,"button","references view");var c=this.dialog.open(e,{});this.overlayContainer.style.zIndex="1002",c.afterClosed().subscribe(function(u){o.overlayContainer.style.zIndex=null})}},{key:"formatValue",value:function(e){return e?"object"==typeof e?e.display?e.display:e.value?e.value:null:e:null}},{key:"displayAmount",value:function(e){var o="";if(e&&"object"==typeof e&&e){var c=!1,u=this.formatValue(e.units);u||(u="");var r=this.formatValue(e.type);r&&(o+=r+"\n"),(e.average||e.high||e.low)&&(e.average&&(o+=e.average,e.units&&(o+=" "+u,c=!0)),(e.high||e.low)&&(o+=" [",e.high&&!e.low?o+="<"+e.high:!e.high&&e.low?o+=">"+e.low:e.high&&e.low&&(o+=e.low+" to "+e.high),o+="] ",c||e.units&&(o+=" "+u,c=!0)),o+=" (average) "),(e.highLimit||e.lowLimit)&&(o+="\n["),e.highLimit&&!e.lowLimit?o+="<"+e.highLimit:!e.highLimit&&e.lowLimit?o+=">"+e.lowLimit:e.highLimit&&e.lowLimit&&(o+=e.lowLimit+" to "+e.highLimit),(e.highLimit||e.lowLimit)&&(o+="] ",c||e.units&&(o+=" "+u,c=!0),o+=" (limits)")}return o}},{key:"close",value:function(){this.dialog.closeAll()}}]),a}(Y.u);return n.\u0275fac=function(a){return new(a||n)(t.Y36(q.F),t.Y36(y.E),t.Y36(p.uw),t.Y36(L.$),t.Y36(Q.Xj))},n.\u0275cmp=t.Xpm({type:n,selectors:[["app-substance-relationships"]],features:[t.qOj],decls:22,vars:10,consts:[[1,"flex-row"],[1,"middle-fill"],[1,"search",3,"floatLabel"],["matInput","","placeholder","Search",3,"formControl"],[2,"padding-left","30px",3,"substance"],[1,"responsive"],["mat-table","","matSort","",3,"dataSource","matSortChange"],["matColumnDef","relatedRecord"],["mat-header-cell","","mat-sort-header","",4,"matHeaderCellDef"],["class","text-center","mat-cell","",4,"matCellDef"],["matColumnDef","type"],["mat-cell","",4,"matCellDef"],["matColumnDef","details"],["mat-header-cell","",4,"matHeaderCellDef"],["matColumnDef","references"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["showFirstLastButtons","true",3,"length","pageSize","pageSizeOptions","page"],["mat-header-cell","","mat-sort-header",""],["mat-cell","",1,"text-center"],[1,"thumb-col"],["appSubstanceImage","",1,"structure-image",3,"entityId"],["target","_blank",1,"substance-name",2,"height","18px",3,"routerLink"],[3,"innerHTML"],["svgIcon","open_in_new",1,"icon"],["mat-cell",""],["mat-header-cell",""],[1,"mat-raised-button","mat-primary",3,"disabled","ngClass","click"],["detailTemplate",""],["mat-dialog-title",""],["mat-dialog-content",""],[1,"details-table","mat-table"],[1,"mat-header-cell"],[1,"mat-cell"],["class","thumb-col",4,"ngIf"],[4,"ngIf"],["class","detail",4,"ngIf"],["mat-dialog-actions",""],["mat-dialog-close","",1,"mat-raised-button","mat-primary",3,"click"],[1,"detail"],[1,"subhead"],[1,"subval"],[1,"mat-raised-button","mat-primary",3,"disabled","click"],["refTemplate",""],[3,"substance","references"],["mat-header-row",""],["mat-row",""]],template:function(a,i){1&a&&(t.TgZ(0,"div",0),t._UZ(1,"span",1),t.TgZ(2,"mat-form-field",2),t._UZ(3,"input",3),t.qZA(),t._UZ(4,"app-relationships-download-button",4),t.qZA(),t.TgZ(5,"div",5),t.TgZ(6,"table",6),t.NdJ("matSortChange",function(o){return i.sortData(o)}),t.ynx(7,7),t.YNc(8,X,2,0,"th",8),t.YNc(9,K,9,6,"td",9),t.BQk(),t.ynx(10,10),t.YNc(11,W,2,0,"th",8),t.YNc(12,G,2,1,"td",11),t.BQk(),t.ynx(13,12),t.YNc(14,tt,2,0,"th",13),t.YNc(15,rt,5,2,"td",11),t.BQk(),t.ynx(16,14),t.YNc(17,ut,2,0,"th",13),t.YNc(18,pt,5,2,"td",11),t.BQk(),t.YNc(19,ft,1,0,"tr",15),t.YNc(20,mt,1,0,"tr",16),t.qZA(),t.qZA(),t.TgZ(21,"mat-paginator",17),t.NdJ("page",function(o){return i.pageChange(o,i.analyticsEventCategory)}),t.qZA()),2&a&&(t.xp6(2),t.Q6J("floatLabel","never"),t.xp6(1),t.Q6J("formControl",i.searchControl),t.xp6(1),t.Q6J("substance",i.substance),t.xp6(2),t.Q6J("dataSource",i.paged),t.xp6(13),t.Q6J("matHeaderRowDef",i.displayedColumns),t.xp6(1),t.Q6J("matRowDefColumns",i.displayedColumns),t.xp6(1),t.Q6J("length",i.filtered&&i.filtered.length||0)("pageSize",5)("pageSizeOptions",t.DdM(9,gt)))},directives:[A.KE,R.Nt,m.Fj,m.JJ,m.oH,$,d.BZ,C.YE,d.w1,d.fO,d.ge,C.nU,d.Dz,d.ev,F.m,h.yS,b.Hw,g.mk,p.uh,p.xY,g.O5,p.H8,p.ZT,k.C,d.as,d.XQ,d.nj,d.Gk,U.NW],styles:["table.mat-table[_ngcontent-%COMP%]{width:100%}td.mat-cell[_ngcontent-%COMP%]:not(:last-child), td.mat-footer-cell[_ngcontent-%COMP%]:not(:last-child), th.mat-header-cell[_ngcontent-%COMP%]:not(:last-child){padding-right:10px}.no-bottom-border[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:last-child   td.mat-cell[_ngcontent-%COMP%]{border-bottom:none}.mat-sort-header-content[_ngcontent-%COMP%]{display:block!important}td.mat-cell[_ngcontent-%COMP%], td.mat-footer-cell[_ngcontent-%COMP%], th.mat-header-cell[_ngcontent-%COMP%]{padding-top:10px;padding-bottom:10px}.structure-image[_ngcontent-%COMP%]{width:150px;height:auto}.search[_ngcontent-%COMP%]{width:400px;max-width:100%}.thumb-col[_ngcontent-%COMP%]{max-width:400px}.subhead[_ngcontent-%COMP%]{display:inline-block;width:130px}.subval[_ngcontent-%COMP%]{display:inline}.details-table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%], td[_ngcontent-%COMP%]{padding:10px}"]}),n}(),vt=l(64061),Zt=l(38277),bt=l(33865),Ct=l(24054),St=function(){var n=(0,v.Z)(function s(){(0,Z.Z)(this,s)});return n.\u0275fac=function(a){return new(a||n)},n.\u0275mod=t.oAB({type:n}),n.\u0275inj=t.cJS({imports:[[g.ez,vt.o.forChild(ht),d.p0,Zt.V,b.Ps,p.Is,U.TU,m.u5,A.lN,m.UX,R.c,bt.HT,_.AV,h.Bz,C.JX,Ct.f]]}),n}()}}]);
//# sourceMappingURL=7549.23787696327c2c87.js.map