"use strict";(self.webpackChunkgsrs_client=self.webpackChunkgsrs_client||[]).push([[8352],{48352:function(W,T,s){s.r(T),s.d(T,{SubstanceHierarchyModule:function(){return G}});var b=s(48047),_=s(78069),x=s(36362),w=s(80206),N=s(98568),Z=s(20265),P=s(24582),E=s(2756),k=s(12570),L=s(44250),D=s(38205),h=s(34972),e=s(76442),S=s(98002),O=s(65590);function U(r,o){1&r&&e._UZ(0,"mat-icon",19)}function Q(r,o){if(1&r&&(e.TgZ(0,"span",20),e._uU(1),e.qZA()),2&r){var i=e.oxw().$implicit;e.xp6(1),e.hij(" ",i.relationship,"")}}var I=function(o,i){return{odd:o,primary:i}},A=function(o){return["/substances",o]},M=function(o){return["/substances",o,"edit"]};function Y(r,o){if(1&r){var i=e.EpF();e.TgZ(0,"mat-tree-node",6),e.TgZ(1,"li",7),e.NdJ("click",function(){var l=e.CHM(i).$implicit;return e.oxw(3).activeNode=l}),e._UZ(2,"button",8),e.TgZ(3,"div",9),e.TgZ(4,"div",10),e._UZ(5,"a",11),e.TgZ(6,"a",12),e.TgZ(7,"span",13),e._uU(8,"edit in new tab"),e.qZA(),e.YNc(9,U,1,0,"mat-icon",14),e.qZA(),e.qZA(),e._UZ(10,"div",15),e.TgZ(11,"div",16),e.TgZ(12,"span",17),e._uU(13),e.qZA(),e.YNc(14,Q,2,1,"span",18),e.qZA(),e.qZA(),e.qZA(),e.qZA()}if(2&r){var a=o.$implicit,t=e.oxw(3);e.xp6(1),e.Q6J("ngClass",e.WLB(9,I,"odd"===a.order,t.activeNode===a)),e.xp6(1),e.uIk("aria-label",a.text),e.xp6(3),e.Q6J("ngClass",a.self?"current-record":"")("routerLink",e.VKq(12,A,a.value.refuuid||""))("innerHTML",a.value.refPname,e.oJD),e.xp6(1),e.Q6J("routerLink",e.VKq(14,M,a.value.refuuid||"")),e.xp6(3),e.Q6J("ngIf",t.isAdmin),e.xp6(4),e.Oqu(a.value.approvalID?a.value.approvalID:"PENDING"),e.xp6(1),e.Q6J("ngIf",""!==a.relationship)}}function V(r,o){1&r&&e._UZ(0,"mat-icon",29)}function q(r,o){if(1&r&&(e.TgZ(0,"span",20),e._uU(1),e.qZA()),2&r){var i=e.oxw().$implicit;e.xp6(1),e.hij(" ",i.relationship,"")}}function F(r,o){if(1&r){var i=e.EpF();e.TgZ(0,"mat-nested-tree-node"),e.TgZ(1,"li",21),e.TgZ(2,"div",7),e.NdJ("click",function(){var l=e.CHM(i).$implicit;return e.oxw(3).activeNode=l})("click",function(){var l=e.CHM(i).$implicit;return e.oxw(3).activeNode=l}),e.TgZ(3,"button",22),e._UZ(4,"mat-icon",23),e.qZA(),e.TgZ(5,"div",24),e.TgZ(6,"div",10),e._UZ(7,"a",25),e.TgZ(8,"a",26),e.YNc(9,V,1,0,"mat-icon",27),e.qZA(),e.qZA(),e.TgZ(10,"div",16),e.TgZ(11,"span",17),e._uU(12),e.qZA(),e.YNc(13,q,2,1,"span",18),e.qZA(),e.qZA(),e.qZA(),e.TgZ(14,"ul"),e.GkF(15,28),e.qZA(),e.qZA(),e.qZA()}if(2&r){var a=o.$implicit,t=e.oxw(3);e.xp6(2),e.Q6J("ngClass",e.WLB(12,I,"odd"===a.order,t.activeNode===a)),e.xp6(1),e.uIk("aria-label","toggle "+a.text),e.xp6(1),e.Q6J("svgIcon",t.treeControl.isExpanded(a)?"chevron_down":"chevron_right"),e.xp6(3),e.Q6J("ngClass",a.self?"current-record":"")("routerLink",e.VKq(15,A,a.value.refuuid||""))("innerHTML",a.value.refPname,e.oJD),e.xp6(1),e.Q6J("routerLink",e.VKq(17,M,a.value.refuuid||"")),e.xp6(1),e.Q6J("ngIf",t.isAdmin),e.xp6(3),e.Oqu(a.value.approvalID||"PENDING"),e.xp6(1),e.Q6J("ngIf",""!==a.relationship),e.xp6(1),e.ekj("hierarchy-tree-invisible",!t.treeControl.isExpanded(a))}}function j(r,o){if(1&r&&(e.TgZ(0,"mat-tree",3),e.YNc(1,Y,15,16,"mat-tree-node",4),e.YNc(2,F,16,19,"mat-nested-tree-node",5),e.qZA()),2&r){var i=e.oxw(2);e.Q6J("dataSource",i.dataSource)("treeControl",i.treeControl),e.xp6(2),e.Q6J("matTreeNodeDefWhen",i.hasChild)}}function B(r,o){if(1&r&&(e.TgZ(0,"div"),e.TgZ(1,"div"),e.TgZ(2,"div",1),e._uU(3,"Substance Hierarchy"),e.qZA(),e.YNc(4,j,3,3,"mat-tree",2),e.qZA(),e.qZA()),2&r){var i=e.oxw();e.xp6(4),e.Q6J("ngIf",i.dataSource.data&&i.dataSource.data.length>0)}}var R=function(){var r=function(o){function i(a,t){var c;return(0,_.Z)(this,i),c=function J(r,o,i){return o=(0,Z.Z)(o),(0,w.Z)(r,(0,N.Z)()?Reflect.construct(o,i||[],(0,Z.Z)(r).constructor):o.apply(r,i))}(this,i),c.substanceService=a,c.authService=t,c.treeControl=new D.VY(function(u){return u.children}),c.dataSource=new h.WX,c.hasChild=function(u,l){return!!l.children&&l.children.length>0},c}return(0,P.Z)(i,o),(0,b.Z)(i,[{key:"ngOnInit",value:function(){var t=this;this.uuid=this.substance.uuid,this.name=this.substance._nameHTML,this.selfNode={id:0,type:"ROOT",parent:"#",expandable:!1,value:{refuuid:this.uuid,name:this.name,approvalID:this.approvalID||""},relationship:""},this.substanceService.getHierarchy(this.uuid).subscribe(function(c){t.loadHierarchy(c)},function(c){t.loadHierarchy([t.selfNode])}),this.isAdmin=this.authService.hasAnyRoles("Admin","Updater","SuperUpdater")}},{key:"loadHierarchy",value:function(t){0===t.length&&t.push(this.selfNode);for(var c=0;c<t.length;c++){var u=t[c];0===u.depth&&(u.parent="#")}t.length>1&&(t=this.formatHierarchy(t));var l=this.list_to_tree(t);this.dataSource.data=l,this.activeNode=this.dataSource.data[0]}},{key:"formatHierarchy",value:function(t){for(var c="",u="",l=[],n=t.length-1;n>=0;n--){0===t[n].depth&&(t[n].parent="#");var d=t[n].value;if(t[n].relationship="",d.refuuid===this.uuid&&(t[n].self=!0),!d.approvalID&&d.linkingID&&10===d.linkingID.length&&(t[n].value.approvalID=t[n].value.linkingID),!t[n].value.approvalID){var H=t[n].text.match(/\[(.*?)\]/);H&&(t[n].value.approvalID=H[1])}d.refuuid===c&&u.includes("HAS ACTIVE MOIETY")&&(l.push([t[n+1].id,t[n].id]),t.splice(n+1,1),t[n].relationship+="{ACTIVE MOIETY} "),t[n].type.includes("HAS ACTIVE MOIETY")?t[n].relationship+="{ACTIVE FORM} ":t[n].type.includes("IS SALT/SOLVATE OF")?t[n].relationship+="{SALT/SOLVATE} ":t[n].type.includes("IS SUBCONCEPT OF")?t[n].relationship+="{SUBCONCEPT} ":t[n].type.includes("IS G1SS CONSTITUENT OF")?t[n].relationship+="{G1SS} ":t[n].type.length>8&&(t[n].relationship="")&&(t[n].relationship+=" {"+t[n].type+"} "),t[n].refuuid=t[n].value.refuuid,c=t[n].refuuid,u=t[n].type}t.sort(function(f,m){var y=f.refuuid.toUpperCase(),C=m.refuuid.toUpperCase();return y===C?f.parent<m.parent?-1:f.parent>m.parent?1:0:y<C?-1:y>C?1:0});for(var p=t.length-1;p>=0;p--)p!==t.length-1&&t[p].value.refuuid===t[p+1].value.refuuid&&t[p].parent===t[p+1].parent&&(t[p].type.includes("HAS ACTIVE MOIETY")&&t[p+1].type.includes("IS SALT/SOLVATE OF")?(l.push([t[p].id,t[p+1].id]),t.splice(p,1)):t[p+1].type.includes("HAS ACTIVE MOIETY")&&t[p].type.includes("IS SALT/SOLVATE OF")&&(l.push([t[p+1].id,t[p].id]),t.splice(p+1,1)));t.sort(function(f,m){return f.id-m.id});for(var v=t.length-1;v>=0;v--)for(var g=0;g<l.length;g++)t[v].parent===l[g][0]&&(t[v].parent=l[g][1]);return t}},{key:"list_to_tree",value:function(t){var l,n,c={},u=[];for(n=0;n<t.length;n+=1)c[t[n].id]=n,t[n].children=[],t[n].order=0===n?"primary":n%2==0?"even":"odd";for(n=0;n<t.length;n+=1)"#"!==(l=t[n]).parent?t[c[l.parent]].children.push(l):u.push(l);return u}}]),i}(E.B);return r.\u0275fac=function(i){return new(i||r)(e.Y36(k.d),e.Y36(L.e))},r.\u0275cmp=e.Xpm({type:r,selectors:[["app-substance-hierarchy"]],features:[e.qOj],decls:1,vars:1,consts:[[4,"ngIf"],[1,"label","tree-label"],["class","hierarchy-tree",3,"dataSource","treeControl",4,"ngIf"],[1,"hierarchy-tree",3,"dataSource","treeControl"],["matTreeNodeToggle","",4,"matTreeNodeDef"],[4,"matTreeNodeDef","matTreeNodeDefWhen"],["matTreeNodeToggle",""],[1,"mat-tree-node",3,"ngClass","click"],["mat-icon-button","","disabled","",1,"tree-button"],[1,"node-container","nochild"],[1,"title"],["matTooltip","view substance details","aria-label","view substance",1,"hierarchy-link",3,"ngClass","routerLink","innerHTML"],["target","_blank","matTooltip","edit substance in new tab","aria-label","edit substance in new tab",1,"hierarchy-edit",3,"routerLink"],["hidden",""],["svgIcon","edit","color","primary",4,"ngIf"],[1,"filler"],[1,"right-container"],[1,"approval"],["class","end",4,"ngIf"],["svgIcon","edit","color","primary"],[1,"end"],[1,"no-border"],["mat-icon-button","","matTreeNodeToggle","",1,"tree-button"],[3,"svgIcon"],[1,"node-container"],["matTooltip","view substance details",1,"hierarchy-link",3,"ngClass","routerLink","innerHTML"],["aria-label","edit substance in new tab",1,"hierarchy-edit",3,"routerLink"],["matTooltip","edit substance in new tab","svgIcon","edit","color","primary",4,"ngIf"],["matTreeNodeOutlet",""],["matTooltip","edit substance in new tab","svgIcon","edit","color","primary"]],template:function(i,a){1&i&&e.YNc(0,B,5,1,"div",0),2&i&&e.Q6J("ngIf",a.substance)},directives:[x.O5,h.gi,h.fQ,h.uo,h.eu,x.mk,S.yS,O.Hw,h.GZ,h.Ar],styles:[".mat-tree-node[_ngcontent-%COMP%]{min-height:30px!important}.hierarchy-tree-invisible[_ngcontent-%COMP%]{display:none}.hierarchy-tree[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%], .hierarchy-tree[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{margin-top:0;margin-bottom:0;list-style-type:none}.spacer[_ngcontent-%COMP%]{width:50%}.approval[_ngcontent-%COMP%]{color:var(--regular-maroon-color);-ms-flex:0 0 100%;flex:0 0 100%}.end[_ngcontent-%COMP%]{white-space:nowrap;max-width:250px;-ms-flex:0 0 100%;flex:0 0 100%;-ms-flex-wrap:nowrap;flex-wrap:nowrap;overflow:hidden;font-style:italic;text-overflow:ellipsis}.hierarchy-link[_ngcontent-%COMP%]{white-space:nowrap;-ms-flex-wrap:nowrap;flex-wrap:nowrap;overflow:hidden;text-overflow:ellipsis}.tree-button[_ngcontent-%COMP%]{height:30px!important;line-height:30px!important;width:35px;background-color:var(--regular-transparent-color);border:0px}.right-container[_ngcontent-%COMP%]{max-width:250px;text-align:right;white-space:nowrap;-ms-flex-wrap:wrap;flex-wrap:wrap;display:-ms-flexbox;display:flex;padding-right:10px;margin:4px;vertical-align:top;-ms-flex-pack:right;justify-content:right}.title[_ngcontent-%COMP%]{-ms-flex-align:center;align-items:center;display:-ms-flexbox;display:flex;max-width:calc(100% - 300px)}.tree-label[_ngcontent-%COMP%]{padding-bottom:10px;font-weight:700}.filler[_ngcontent-%COMP%]{-ms-flex:1 1 auto;flex:1 1 auto;vertical-align:center;height:2px;margin-top:auto;margin-bottom:auto;margin-left:50px;padding-left:20px}.filler-line[_ngcontent-%COMP%]{height:2px;width:100%}.no-border[_ngcontent-%COMP%]{border-top:0px}.primary[_ngcontent-%COMP%]{background-color:var(--sub-hierarchy-bg-color)!important}.hierarchy-link[_ngcontent-%COMP%]{color:var(--link-primary-color);font-style:unset;max-lines:2}.odd[_ngcontent-%COMP%]{background-color:var(--sub-hierarchy-odd-bg-color)}.node-container[_ngcontent-%COMP%]{display:-ms-flexbox;display:flex;width:calc(100% - 35px);-ms-flex-pack:justify;justify-content:space-between}.hierarchy-edit[_ngcontent-%COMP%]{height:20px;margin-left:15px}.mat-card[_ngcontent-%COMP%]{max-width:1228px;margin-bottom:20px}.mat-card[_ngcontent-%COMP%], .controls-container[_ngcontent-%COMP%]{width:100%;box-sizing:border-box}.current-record[_ngcontent-%COMP%]{font-weight:700}"]}),r}(),$=s(64061),G=function(){var r=(0,b.Z)(function o(){(0,_.Z)(this,o)});return r.\u0275fac=function(i){return new(i||r)},r.\u0275mod=e.oAB({type:r}),r.\u0275inj=e.cJS({imports:[[x.ez,S.Bz,$.o.forChild(R),h.dp,O.Ps]]}),r}()}}]);
//# sourceMappingURL=8352.3644f08e397b797a.js.map