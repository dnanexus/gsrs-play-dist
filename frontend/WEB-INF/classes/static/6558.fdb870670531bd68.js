"use strict";(self.webpackChunkgsrs_client=self.webpackChunkgsrs_client||[]).push([[6558],{16558:function(Se,b,s){s.r(b),s.d(b,{SubstanceFormDefinitionModule:function(){return Ce}});var C=s(48047),S=s(78069),p=s(36362),O=s(80206),E=s(98568),_=s(20265),M=s(24582),e=s(76442),N=s(79223),P=s(42827),U=s(12570),L=s(33567),y=s(75939),f=s(90587),J=s(59295),H=s(53141),Q=s(54244),v=s(98002),g=s(44770),x=s(91434),Y=s(1130),R=s(24459),Z=s(61534),w=s(84577),A=s(40089),D=s(65590),m=s(81196),h=s(43188),k=s(14521),B=s(14900),j=s(13821),z=["tagsInput"];function q(i,c){if(1&i&&(e.TgZ(0,"span",23),e._uU(1),e.qZA()),2&i){var o=e.oxw(2);e.xp6(1),e.Oqu(o.definition.approvalID)}}function G(i,c){if(1&i&&(e.TgZ(0,"div",24),e.TgZ(1,"div"),e._uU(2),e.ALo(3,"elementLabel"),e._UZ(4,"span",25),e.qZA(),e.qZA()),2&i){var o=e.oxw(2);e.xp6(2),e.hij("",e.xi3(3,2,"displayNameTitle","substance_names_name"),": "),e.xp6(2),e.Q6J("innerHTML",o.definition._nameHTML?o.definition._nameHTML:o.definition._name,e.oJD)}}function K(i,c){if(1&i&&(e.TgZ(0,"mat-option",28),e._uU(1),e.qZA()),2&i){var o=c.$implicit;e.Q6J("value",o.value),e.xp6(1),e.hij(" ",o.display," ")}}function X(i,c){if(1&i){var o=e.EpF();e.TgZ(0,"mat-form-field",26),e.TgZ(1,"mat-label"),e._uU(2,"Definition Type"),e.qZA(),e.TgZ(3,"mat-select",27),e.NdJ("ngModelChange",function(n){return e.CHM(o),e.oxw(2).definition.definitionType=n})("selectionChange",function(n){return e.CHM(o),e.oxw(2).updateDefinitionType(n)}),e.YNc(4,K,2,2,"mat-option",20),e.qZA(),e.qZA()}if(2&i){var r=e.oxw(2);e.xp6(3),e.Q6J("ngModel",r.definition.definitionType),e.xp6(1),e.Q6J("ngForOf",r.definitionTypes)}}function $(i,c){if(1&i){var o=e.EpF();e.TgZ(0,"div",29),e.TgZ(1,"app-substance-selector",30),e.NdJ("selectionUpdated",function(n){return e.CHM(o),e.oxw(2).primartySubstanceUpdated(n)}),e.qZA(),e.qZA()}if(2&i){var r=e.oxw(2);e.xp6(1),e.Q6J("subuuid",r.primarySubUuid)}}function W(i,c){if(1&i&&(e.TgZ(0,"mat-option",28),e._uU(1),e.qZA()),2&i){var o=c.$implicit;e.Q6J("value",o.value),e.xp6(1),e.hij(" ",o.display," ")}}function ee(i,c){if(1&i){var o=e.EpF();e.TgZ(0,"mat-form-field"),e.TgZ(1,"mat-label"),e._uU(2,"Definition Level"),e.qZA(),e.TgZ(3,"mat-select",31),e.NdJ("ngModelChange",function(n){return e.CHM(o),e.oxw(2).definition.definitionLevel=n})("selectionChange",function(){return e.CHM(o),e.oxw(2).updateDefinition()}),e.YNc(4,W,2,2,"mat-option",20),e.qZA(),e.qZA()}if(2&i){var r=e.oxw(2);e.xp6(3),e.Q6J("ngModel",r.definition.definitionLevel),e.xp6(1),e.Q6J("ngForOf",r.definitionLevels)}}function te(i,c){if(1&i&&(e.TgZ(0,"a",36),e._uU(1," Old edit form "),e._UZ(2,"mat-icon",35),e.qZA()),2&i){var o=e.oxw(3);e.Q6J("href",o.getRedirect(),e.LSH)}}var ne=function(c){return["/substances",c]};function ie(i,c){if(1&i&&(e.TgZ(0,"div",32),e.YNc(1,te,3,1,"a",33),e._UZ(2,"br"),e.TgZ(3,"a",34),e._uU(4," Details page "),e._UZ(5,"mat-icon",35),e.qZA(),e.qZA()),2&i){var o=e.oxw(2);e.xp6(1),e.Q6J("ngIf",o.oldlink),e.xp6(2),e.Q6J("routerLink",e.VKq(2,ne,o.uuid))}}function oe(i,c){if(1&i){var o=e.EpF();e.TgZ(0,"mat-chip",37),e.NdJ("removed",function(){var a=e.CHM(o).$implicit;return e.oxw(2).removeTag(a)}),e._uU(1),e._UZ(2,"mat-icon",38),e.qZA()}if(2&i){var r=c.$implicit;e.xp6(1),e.hij(" ",r," ")}}function ae(i,c){if(1&i&&(e.TgZ(0,"mat-option",28),e._uU(1),e.qZA()),2&i){var o=c.$implicit;e.Q6J("value",o),e.xp6(1),e.hij(" ",o," ")}}function se(i,c){if(1&i&&(e.TgZ(0,"div",5),e.TgZ(1,"div",39),e._UZ(2,"app-domain-references",40,41),e.qZA(),e.qZA()),2&i){var o=e.oxw(2);e.xp6(2),e.Q6J("referencesUuids",o.definition.references)}}function re(i,c){if(1&i){var o=e.EpF();e.TgZ(0,"div",5),e.TgZ(1,"div",42),e.TgZ(2,"app-access-manager",43),e.NdJ("accessOut",function(n){return e.CHM(o),e.oxw(2).updateDefAccess(n)}),e.qZA(),e.qZA(),e.qZA()}if(2&i){var r=e.oxw(2);e.xp6(1),e.MGl("matTooltip","Set ",r.definition.substanceClass," access"),e.xp6(1),e.Q6J("access",r.defAccess)}}function ce(i,c){1&i&&(e.TgZ(0,"div",5),e._uU(1," Concepts have no defining information, but are collections of terms, codes and related information. "),e._UZ(2,"br"),e._uU(3," They can be promoted to a defined substance at a later time, when appropriate. "),e.qZA())}function ue(i,c){if(1&i){var o=e.EpF();e.TgZ(0,"div"),e.TgZ(1,"div",1),e.TgZ(2,"div"),e.TgZ(3,"span",2),e._uU(4),e.qZA(),e.TgZ(5,"span"),e._uU(6),e.ALo(7,"titlecase"),e.qZA(),e.qZA(),e.YNc(8,q,2,1,"span",3),e.qZA(),e.YNc(9,G,5,5,"div",4),e.TgZ(10,"div",5),e.YNc(11,X,5,2,"mat-form-field",6),e.YNc(12,$,2,1,"div",7),e.YNc(13,ee,5,2,"mat-form-field",0),e.TgZ(14,"div",8),e.TgZ(15,"mat-checkbox",9),e.NdJ("ngModelChange",function(u){return e.CHM(o),e.oxw().definition.deprecated=u})("change",function(){return e.CHM(o),e.oxw().updateDefinition()}),e._uU(16,"Deprecated"),e.qZA(),e.qZA(),e.TgZ(17,"div"),e.TgZ(18,"app-access-manager",10),e.NdJ("accessOut",function(u){return e.CHM(o),e.oxw().updateAccess(u)}),e.qZA(),e.qZA(),e.YNc(19,ie,6,4,"div",11),e.qZA(),e.TgZ(20,"div",5),e.TgZ(21,"mat-form-field",12),e.TgZ(22,"mat-chip-list",13,14),e.YNc(24,oe,3,1,"mat-chip",15),e.TgZ(25,"input",16,17),e.NdJ("matChipInputTokenEnd",function(u){return e.CHM(o),e.oxw().tagAdded(u)})("blur",function(){return e.CHM(o),e.oxw().tagsBlurred()}),e.qZA(),e.qZA(),e.TgZ(27,"mat-autocomplete",18,19),e.NdJ("opened",function(){return e.CHM(o),e.oxw().increaseOverlayZindex()})("closed",function(){return e.CHM(o),e.oxw().tagsAutocompleteClosed()})("optionSelected",function(u){return e.CHM(o),e.oxw().selectedTag(u)}),e.YNc(29,ae,2,2,"mat-option",20),e.qZA(),e.TgZ(30,"mat-hint"),e._uU(31,"Enter new tags (and press Enter after each entry) or select from suggested tags below"),e.qZA(),e.qZA(),e.qZA(),e.YNc(32,se,4,1,"div",21),e.YNc(33,re,3,2,"div",21),e.YNc(34,ce,4,0,"div",21),e._UZ(35,"app-audit-info",22),e.qZA()}if(2&i){var r=e.MAs(23),t=e.MAs(28),n=e.oxw();e.xp6(4),e.Oqu(n.uuid&&!n.imported?"Editing ":"Registering New "),e.xp6(2),e.hij(" ",e.lcZ(7,20,n.substanceClass),""),e.xp6(2),e.Q6J("ngIf",n.definition.approvalID&&""!==n.definition.approvalID),e.xp6(1),e.Q6J("ngIf",n.definition._name),e.xp6(2),e.Q6J("ngIf","concept"!==n.definition.substanceClass),e.xp6(1),e.Q6J("ngIf","ALTERNATIVE"==n.definition.definitionType),e.xp6(1),e.Q6J("ngIf","concept"!==n.definition.substanceClass),e.xp6(2),e.Q6J("ngModel",n.definition.deprecated),e.xp6(3),e.Q6J("access",n.definition.access),e.xp6(1),e.Q6J("ngIf",n.uuid),e.xp6(5),e.Q6J("ngForOf",n.definition.tags),e.xp6(1),e.Q6J("formControl",n.tagsCtrl)("matAutocomplete",t)("matChipInputFor",r)("matChipInputSeparatorKeyCodes",n.separatorKeysCodes),e.xp6(4),e.Q6J("ngForOf",n.filteredSuggestedTags),e.xp6(3),e.Q6J("ngIf","concept"!==n.definition.substanceClass),e.xp6(1),e.Q6J("ngIf","concept"!==n.definition.substanceClass),e.xp6(1),e.Q6J("ngIf","concept"===n.definition.substanceClass),e.xp6(1),e.Q6J("source",n.definition)}}var le=function(){var i=function(c){function o(r,t,n,a,u,d){var l;return(0,S.Z)(this,o),l=function V(i,c,o){return c=(0,_.Z)(c),(0,O.Z)(i,(0,E.Z)()?Reflect.construct(c,o||[],(0,_.Z)(i).constructor):c.apply(i,o))}(this,o),l.cvService=r,l.substanceService=t,l.substanceFormService=n,l.overlayContainerService=a,l.configService=u,l.activatedRoute=d,l.separatorKeysCodes=[y.K5,y.OC],l.tagsCtrl=new f.NI({value:"",disabled:!0}),l.usedSuggestedTags=[],l.subscriptions=[],l.imported=!1,l.oldlink=!1,l}return(0,M.Z)(o,c),(0,C.Z)(o,[{key:"ngOnInit",value:function(){var t=this;this.overlayContainer=this.overlayContainerService.getContainerElement(),this.menuLabelUpdate.emit("Overview"),this.getVocabularies(),this.substanceService.getTags().subscribe(function(a){t.suggestedTags=a,t.filteredSuggestedTags=a,t.crossCheckTags(),t.tagsCtrl.enable()});var n=this.tagsCtrl.valueChanges.subscribe(function(a){t.filteredSuggestedTags=t.suggestedTags.filter(function(u){return u.toLowerCase().indexOf((a||"").toLowerCase())>-1})});this.subscriptions.push(n),this.configService.configData&&this.configService.configData.showOldLinks&&(this.oldlink=!0)}},{key:"ngAfterViewInit",value:function(){var t=this,n=this.substanceFormService.definition.subscribe(function(a){t.defAccess=t.substanceFormService.getDefinitionForDefRef(),t.definition=a||{},t.crossCheckTags(),t.substanceClass="structure"===t.definition.substanceClass?"chemical":"nucleicAcid"===t.definition.substanceClass?"Nucleic Acid":"structurallyDiverse"===t.definition.substanceClass?"Structurally Diverse":"SPECIFIEDSUBSTANCE"===t.definition.substanceClass.toUpperCase()?"Specified Substance Group 1":"SPECIFIEDSUBSTANCEG3"===t.definition.substanceClass.toUpperCase()?"Specified Substance Group 3":t.definition.substanceClass,t.definition.definitionType||(t.definition.definitionType="PRIMARY"),t.definition.definitionLevel||(t.definition.definitionLevel="COMPLETE"),t.json=t.substanceFormService.getJson(),t.definition.status&&(t.status=t.definition.status),"ALTERNATIVE"===t.definition.definitionType&&t.cvService.getDomainVocabulary("RELATIONSHIP_TYPE").pipe((0,J.q)(1)).subscribe(function(l){var F=l.RELATIONSHIP_TYPE&&l.RELATIONSHIP_TYPE.dictionary["SUB_ALTERNATE->SUBSTANCE"]&&l.RELATIONSHIP_TYPE.dictionary["SUB_ALTERNATE->SUBSTANCE"].value||null;if(F&&t.definition.relationships&&t.definition.relationships.length){var I=t.definition.relationships.find(function(T){return T.type===F});null!=I&&t.substanceService.getSubstanceSummary(I.relatedSubstance.refuuid).subscribe(function(T){t.primarySubstance=T,t.primarySubUuid=t.primarySubstance.uuid})}}),t.uuid=t.substanceFormService.getUuid();var u=t.substanceFormService.getMethod(),d=t.activatedRoute.snapshot.queryParams.source||null;t.imported=!(!u||"import"!==u||d&&"draft"===d)});this.subscriptions.push(n)}},{key:"ngOnDestroy",value:function(){this.subscriptions.forEach(function(t){t.unsubscribe()})}},{key:"getRedirect",value:function(){return this.uuid?this.substanceService.oldSiteRedirect("edit",this.substanceFormService.getUuid()):"#"}},{key:"getVocabularies",value:function(){var t=this;this.cvService.getDomainVocabulary("DEFINITION_TYPE","DEFINITION_LEVEL").subscribe(function(n){t.definitionTypes=n.DEFINITION_TYPE.list,t.definitionLevels=n.DEFINITION_LEVEL.list})}},{key:"updateDefinitionType",value:function(t){var n=this;if("PRIMARY"===this.definition.definitionType&&null!=this.definition.relationships&&this.definition.relationships.length){var a=this.definition.relationships.findIndex(function(u){return u.relatedSubstance.refuuid===n.primarySubstance.uuid});a>-1&&this.definition.relationships.splice(a,1),this.primarySubstance=null}this.substanceFormService.updateDefinition(this.definition)}},{key:"primartySubstanceUpdated",value:function(t){null!=t?this.setPrimarySubstance(t):this.removePrimarySubstance()}},{key:"setPrimarySubstance",value:function(t){var n=this;this.primarySubstance=t,this.primarySubUuid=t.uuid,(null==this.definition.relationships||"[object Array]"!==Object.prototype.toString.call(this.definition.relationships))&&(this.definition.relationships=[]),this.cvService.getDomainVocabulary("RELATIONSHIP_TYPE").subscribe(function(a){n.definition.relationships.push({relatedSubstance:{refuuid:n.primarySubstance.uuid,refPname:n.primarySubstance._name,approvalID:n.primarySubstance.approvalID,substanceClass:"reference"},access:[],type:a.RELATIONSHIP_TYPE&&a.RELATIONSHIP_TYPE.dictionary["SUB_ALTERNATE->SUBSTANCE"]&&a.RELATIONSHIP_TYPE.dictionary["SUB_ALTERNATE->SUBSTANCE"].value||""}),n.substanceFormService.updateDefinition(n.definition)})}},{key:"removePrimarySubstance",value:function(){var t=this,n=this.definition.relationships.findIndex(function(a){return a.relatedSubstance.refuuid===t.primarySubUuid});this.definition.relationships.splice(n,1),this.primarySubstance=null,this.substanceFormService.updateDefinition(this.definition)}},{key:"updateAccess",value:function(t){this.definition.access=t,this.substanceFormService.updateDefinition(this.definition)}},{key:"updateDefAccess",value:function(t){this.substanceFormService.setDefinitionFromDefRef(t),this.substanceFormService.updateDefinition(this.definition)}},{key:"updateDefinition",value:function(){this.substanceFormService.updateDefinition(this.definition)}},{key:"crossCheckTags",value:function(){var t=this;if(null!=this.definition&&null!=this.definition.tags&&this.definition.tags.length>0&&null!=this.suggestedTags){this.definition.tags.sort();var a=0;this.definition.tags.forEach(function(u){for(a=a;a<t.suggestedTags.length;a++)if(u.toLowerCase()===t.suggestedTags[a].toLowerCase()){t.suggestedTags.splice(a,1);break}})}}},{key:"tagAdded",value:function(t){if((t.value||"").trim()){var n=t.value.trim();this.addTag(n)}t.input&&(t.input.value="")}},{key:"addTag",value:function(t){this.definition.tags.push(t),this.updateDefinition();for(var n=0;n<this.suggestedTags.length;n++)if(t.toLowerCase()===this.suggestedTags[n].toLowerCase()){this.suggestedTags.splice(n,1);break}}},{key:"removeTag",value:function(t){var n=this.definition.tags.indexOf(t);if(n>-1&&(this.definition.tags.splice(n,1),this.updateDefinition(),this.usedSuggestedTags.length>0))for(var a=0;a<this.usedSuggestedTags.length;a++)if(t.toLowerCase()===this.usedSuggestedTags[a].toLowerCase()){var u=this.usedSuggestedTags.splice(a,1)[0];this.suggestedTags.push(u),this.suggestedTags.sort();break}}},{key:"selectedTag",value:function(t){this.definition.tags.push(t.option.value),this.updateDefinition(),this.tagsCtrl.setValue(null),this.tagsInput.nativeElement.value="",this.usedSuggestedTags.push(t.option.value);var n=this.suggestedTags.indexOf(t.option.value);n>-1&&this.suggestedTags.splice(n,1)}},{key:"tagsAutocompleteClosed",value:function(){this.decreaseOverlayZindex();var t=this.tagsCtrl.value;null!=t&&""!==t&&(t=t.trim(),this.addTag(t),this.tagsCtrl.setValue(null),this.tagsInput.nativeElement.value="")}},{key:"tagsBlurred",value:function(){if(0===this.filteredSuggestedTags.length){var t=this.tagsCtrl.value;null!=t&&""!==t&&(t=t.trim(),this.addTag(t),this.tagsCtrl.setValue(null),this.tagsInput.nativeElement.value="")}}},{key:"increaseOverlayZindex",value:function(){this.overlayContainer.style.zIndex="1002"}},{key:"decreaseOverlayZindex",value:function(){this.overlayContainer.style.zIndex=null}}]),o}(N.o);return i.\u0275fac=function(o){return new(o||i)(e.Y36(P.I),e.Y36(U.d),e.Y36(L.B),e.Y36(Q.Xj),e.Y36(H.E),e.Y36(v.gz))},i.\u0275cmp=e.Xpm({type:i,selectors:[["app-substance-form-definition"]],viewQuery:function(o,r){var t;1&o&&e.Gf(z,5,e.SBq),2&o&&e.iGM(t=e.CRH())&&(r.tagsInput=t.first)},features:[e.qOj],decls:1,vars:1,consts:[[4,"ngIf"],[1,"substance-form-row","form-header"],[1,"sub-header"],["class","approval",4,"ngIf"],["class","substance-form-row form-name",4,"ngIf"],[1,"substance-form-row"],["style","margin-right: 5px",4,"ngIf"],["class","primary-substance-container",4,"ngIf"],[1,"checkbox-container"],["name","deprecated",3,"ngModel","ngModelChange","change"],["label","Record Level Access",3,"access","accessOut"],["class","redirect-links",4,"ngIf"],[1,"tag-list"],["aria-label","Tags edit","selectable","false"],["tagList",""],["removable","true",3,"removed",4,"ngFor","ngForOf"],["placeholder","Substance tags",3,"formControl","matAutocomplete","matChipInputFor","matChipInputSeparatorKeyCodes","matChipInputTokenEnd","blur"],["tagsInput",""],[3,"opened","closed","optionSelected"],["tagsAuto","matAutocomplete"],[3,"value",4,"ngFor","ngForOf"],["class","substance-form-row",4,"ngIf"],[3,"source"],[1,"approval"],[1,"substance-form-row","form-name"],[1,"name",3,"innerHTML"],[2,"margin-right","5px"],["name","definitionType","required","",3,"ngModel","ngModelChange","selectionChange"],[3,"value"],[1,"primary-substance-container"],["eventCategory","substanceFormDefinitionType","placeholder","Primary Substance","header","Primary Substance",3,"subuuid","selectionUpdated"],["name","definitionLevel",3,"ngModel","ngModelChange","selectionChange"],[1,"redirect-links"],["target","_blank","matTooltip","open old edit form in new tab",3,"href",4,"ngIf"],["target","_blank","matTooltip","open details page in new tab",3,"routerLink"],["svgIcon","open_in_new",1,"icon"],["target","_blank","matTooltip","open old edit form in new tab",3,"href"],["removable","true",3,"removed"],["matChipRemove","","svgIcon","cancel"],[1,"references-container"],["card","definition",3,"referencesUuids"],["references",""],[3,"matTooltip"],["label","Definition Access",3,"access","accessOut"]],template:function(o,r){1&o&&e.YNc(0,ue,36,22,"div",0),2&o&&e.Q6J("ngIf",r.definition)},directives:[p.O5,g.KE,g.hX,x.gD,f.Q7,f.JJ,f.On,p.sg,Y.ey,R.Q,Z.oG,w.h,A.gM,D.Hw,v.yS,m.qn,m.HS,m.qH,f.Fj,h.ZL,m.oH,f.oH,h.XC,g.bx,k.V,B.n],pipes:[p.rS,j.f],styles:[".substance-form-row[_ngcontent-%COMP%]{display:-ms-flexbox;display:flex;-ms-flex-pack:justify;justify-content:space-between}.approval[_ngcontent-%COMP%]{color:var(--pink-span-color);font-size:24px}.primary-substance-container[_ngcontent-%COMP%]{max-width:25%}.section-header[_ngcontent-%COMP%]{color:var(--dark-label-color);font-size:11px;text-align:left;letter-spacing:.005px}.form-header[_ngcontent-%COMP%]{padding-bottom:20px;font-weight:500;font-size:28px}.sub-header[_ngcontent-%COMP%]{font-weight:400;padding-right:5px}.references-container[_ngcontent-%COMP%]{width:100%}.checkbox-container[_ngcontent-%COMP%]{padding-top:10px}.definition-reference[_ngcontent-%COMP%]{margin-bottom:0}.redirect-links[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{color:var(--primary-color)!important;float:right;text-decoration:none}.redirect-links[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{-ms-transform:scale(.75);transform:scale(.75)}.icon[_ngcontent-%COMP%]{font-size:10px!important}.set-status[_ngcontent-%COMP%]     .mat-radio-label{-ms-flex-direction:column-reverse;flex-direction:column-reverse}.set-status[_ngcontent-%COMP%]     .mat-radio-label-content{padding-left:5px;font-size:11px;padding-bottom:4px;color:var(--dark-label-color);font-weight:400;font-family:Roboto,Helvetica Neue,sans-serif}.status-label[_ngcontent-%COMP%]{padding-right:10px}.message-field[_ngcontent-%COMP%]{width:50%}.form-name[_ngcontent-%COMP%]{font-size:22px;padding-bottom:15px}.name[_ngcontent-%COMP%]{color:var(--regular-blue-color);padding-left:5px}.tag-list[_ngcontent-%COMP%]{width:100%}"]}),i}(),de=s(64061),fe=s(82796),me=s(87317),pe=s(7168),ge=s(94673),ve=s(63200),he=s(68390),Te=s(60833),be=s(88547),Ce=function(){var i=(0,C.Z)(function c(){(0,S.Z)(this,c)});return i.\u0275fac=function(o){return new(o||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[[p.ez,de.o.forChild(le),f.UX,f.u5,g.lN,x.LD,fe.Tx,Z.p9,me.ot,D.Ps,pe.O,ge.w,ve.U,A.AV,v.Bz,he.Fk,m.Hi,h.Bb,Te.Cv,be.J]]}),i}()}}]);
//# sourceMappingURL=6558.fdb870670531bd68.js.map